### Stages
stages:
  - test
  - pages


### Unit test
unit-test:
  image: python:3.10
  stage: test
  before_script:
    - cd flask-app
    # Install requirements
    - pip install -r requirements.txt
  script:
    # Run unit tests with coverage enabled
    - python -m coverage run -m unittest
    # Generate an HTML report of the coverage results
    - coverage html
  artifacts:
    paths:
      # Specify the directory to store the coverage report as an artifact
      - flask-app/htmlcov/


### Deploy unit test results to GitLab Pages
pages:
  image: python:3.10
  stage: pages
  dependencies:
    # Use artifacts generated by the 'unit-test' stage
    - unit-test
  script:
    # Move the coverage report to the 'public/' directory for GitLab Pages
    - mv flask-app/htmlcov/ public/
  artifacts:
    paths:
      # Specify the 'public/' directory to be published via GitLab Pages
      - public/